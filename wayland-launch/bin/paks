#!/bin/sh
set -e

toplevel=${SNAP_USER_DATA}

cpack_downloader() {
if [ -f /usr/bin/curl ]; then
	curl -O ${SNAP_USER_DATA}/et-linux-2.60.x86.run $1
else
	wget -O ${SNAP_USER_DATA}/et-linux-2.60.x86.run $1
fi
}

checksum=`mktemp`
cat >$checksum <<'EOF'
41cbbc1afb8438bc8fc74a64a171685550888856005111cbf9af5255f659ae36  ${SNAP_USER_DATA}/et-linux-2.60.x86.run
EOF

echo "Fetching Wolf:ET assets data files..."
if [ ! -f et-linux-2.60.x86.run ]; then
	cpack_downloader http://ftp.gwdg.de/pub/misc/ftp.idsoftware.com/idstuff/et/linux/et-linux-2.60.x86.run
fi

# This needs to be fixed 
#echo "Verifying assets data files integrity" 
#sha256sum -c $checksum || exit 1
echo "Installing assets..."
chmod +x ${SNAP_USER_DATA}/et-linux-2.60.x86.run
${SNAP_USER_DATA}/et-linux-2.60.x86.run --noexec --target ${toplevel}
rm -rf ${toplevel}/{bin,Docs,README,pb,openurl.sh,CHANGES,ET.xpm} ${toplevel}/setup.{data,sh} ${toplevel}/etmain/{*.cfg,*.so,*.txt,*.dat,mp_bin.pk3}
rm -f ${SNAP_USER_DATA}/et-linux-2.60.x86.run
